
\documentclass{book}

\usepackage{nopageno}

\usepackage{vmargin}
\usepackage{times}
\usepackage{graphics}
\usepackage{amsmath, amscd, amsxtra, amsthm}
\usepackage{amssymb}
\usepackage[retainorgcmds]{IEEEtrantools}
\usepackage{framed}
\usepackage{mdframed}
\usepackage{float}
\usepackage{color}

\usepackage{xstring}

\usepackage{ragged2e}

\usepackage{enumitem}

%% Suggested by http://tex.stackexchange.com/questions/349580
\usepackage{array}

% This package makes cut-and-paste of carets work right, so
% we can cut-and-paste from the PDF document into Maxima.

\usepackage[T1]{fontenc}

\usepackage{tikz}
\usetikzlibrary{positioning, fit}

\begin{document}

\tikzstyle{task} = [draw, fill=blue!20, text width=8em, text depth=8em, text centered,
  minimum width=10em, minimum height=10em, rounded corners]

\tikzstyle{message} = [draw, fill=red!20, text width=5em, text depth=2em, text centered,
  minimum width=5em, minimum height=2em, rounded corners]

\newcommand\task[4]{
\node (#1) [matrix, task] at (#2) {\node {#1}; #4

\IfSubStr{#3}{l}{
\foreach \i in {-8,...,8}%
{
  \draw[xshift=-5em, ultra thick] (0,0.2 * \i) -- (0.2,0.2 * \i) coordinate (#1 Port \i);

}
}{}

\IfSubStr{#3}{r}{
\foreach \i in {-8,...,8}%
{
  \draw[xshift=5em, ultra thick] (-0.2,0.2 * \i) -- (0,0.2 * \i) coordinate (#1 Port \i);

}
}{}

\\};
}

\begin{center}
\begin{tikzpicture}

\task{Task 1}{0,0}{r}{
\node (message1) [message] {Message 1};
}
\task{Task 2}{15 em,0}{l}{
\node (message2) [message] {Message 1};
\node (message2a) [message] at (1 em, -2 em) {Message 2};
}
\task{Task 3}{0,-15 em}{r}{
\node (message3) [message] {Message 2};
}


\draw [color=violet, thick, ->] (node cs:name=message1,angle=20) -- +(.3,0) |- (Task 1 Port 3) node [midway, anchor=south, color=black] {27} -- (Task 2 Port 3)
    -- +(.3,0) node [near end, anchor=south, color=black] {52} |- (node cs:name=message2, angle=160);

\draw [color=violet, thick, ->] (node cs:name=message3,angle=0) -- +(.3,0) |- (Task 3 Port 0) node [midway, anchor=south, color=black] {18} -- +(1,0) |- (Task 2 Port 3)
    -- +(.3,0) |- (node cs:name=message2a, angle=160);


\end{tikzpicture}
\end{center}


% https://events.ccc.de/congress/2007/Fahrplan/attachments/986_inside_the_mac_osx_kernel.pdf

% Mac OS X Internals: A Systems Approach

\end{document}
